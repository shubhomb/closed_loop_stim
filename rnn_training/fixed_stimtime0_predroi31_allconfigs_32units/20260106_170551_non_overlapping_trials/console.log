2026-01-06 17:05:51,506 INFO: Logging started. Output file: rnn_training/20260106_170551/console.log
2026-01-06 17:05:51,506 INFO: Seed: 42
2026-01-06 17:05:51,507 INFO: Number of epochs 30
2026-01-06 17:05:51,718 INFO: Target neurons: [31]
2026-01-06 17:05:51,719 INFO: Target indices in filtered data: [30]
2026-01-06 17:05:51,719 INFO: configs shape: (3, 110, 31)
2026-01-06 17:05:51,720 INFO: roi_used shape: (512, 512)
2026-01-06 17:05:51,721 INFO: times shape: (3, 8, 31)
2026-01-06 17:05:51,721 INFO: dfof shape: (3, 15600, 110)
2026-01-06 17:05:53,501 INFO: Creating trials DataFrame with STIM_OFFSET=0 (stim at frame 0 of each snippet)
2026-01-06 17:05:53,501 INFO: Creating trials DataFrame with STIM_DELAY=0 (stim at frame 0 of each snippet)
2026-01-06 17:05:53,505 INFO: Total trials before filtering: 744
2026-01-06 17:05:53,506 INFO: Final trials_df size: 744
2026-01-06 17:05:53,506 INFO: DataFrame shape: (744, 9)
2026-01-06 17:05:53,508 INFO: Trials per session: {0: 248, 1: 248, 2: 248}
2026-01-06 17:05:53,508 INFO: Unique values:
2026-01-06 17:05:53,508 INFO:   Sessions: 0, 1, 2
2026-01-06 17:05:53,509 INFO:   Configs: 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31
2026-01-06 17:05:53,509 INFO:   Electrodes: -1, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9
2026-01-06 17:05:53,509 INFO:   Currents: 0, 3, 4, 5
2026-01-06 17:05:53,510 INFO: --- Filter Status ---
2026-01-06 17:05:53,511 INFO:   FILTER_CONFIGS: All
2026-01-06 17:05:53,511 INFO:   FILTER_NEURONS: All
2026-01-06 17:05:53,512 INFO:   FILTER_ELECTRODES: All
2026-01-06 17:05:53,512 INFO:   FILTER_CURRENTS: All
2026-01-06 17:05:53,514 INFO: trials_df head:
   session  trial  config  electrode  current  trial_start_time  stim_time  \
0        0      0       1          0        3              2811       2811   
1        0      1       1          0        3              3807       3807   
2        0      2       1          0        3              4181       4181   
3        0      3       1          0        3              6609       6609   
4        0      4       1          0        3              8787       8787   
5        0      5       1          0        3             11589      11589   
6        0      6       1          0        3             12647      12647   
7        0      7       1          0        3             12772      12772   
8        0      0       2          0        4              1130       1130   
9        0      1       2          0        4              6173       6173   

   start_time  is_stim  
0        2811     True  
1        3807     True  
2        4181     True  
3        6609     True  
4        8787     True  
5       11589     True  
6       12647     True  
7       12772     True  
8        1130     True  
9        6173     True  
2026-01-06 17:05:53,514 INFO: --- Example queries ---
2026-01-06 17:05:53,515 INFO: Electrode 9, Current 5: 24 trials
2026-01-06 17:05:53,516 INFO: Session 0, Config 7: 8 trials
2026-01-06 17:05:59,161 INFO: Snippets DataFrame shape: (744, 18)
2026-01-06 17:05:59,163 INFO: Valid snippets: 744
2026-01-06 17:05:59,163 INFO: Snippets with stim at t=0: 720
2026-01-06 17:05:59,166 INFO: Holdout stim times per session: {np.int64(0): 31, np.int64(1): 31, np.int64(2): 31}
2026-01-06 17:05:59,182 INFO: Trial holdout [7]: train=522, val=93, test=129
2026-01-06 17:05:59,182 INFO: === Split Summary (trial) ===
2026-01-06 17:05:59,182 INFO: Train: 522 samples (70.2%)
2026-01-06 17:05:59,183 INFO:   Sessions: [np.int64(0), np.int64(1), np.int64(2)]
2026-01-06 17:05:59,184 INFO: Val: 93 samples (12.5%)
2026-01-06 17:05:59,184 INFO: Test: 129 samples (17.3%)
2026-01-06 17:05:59,185 INFO:   Sessions: [np.int64(0), np.int64(1), np.int64(2)]
2026-01-06 17:06:13,292 INFO: Batch size: 4
2026-01-06 17:06:13,293 INFO: Split strategy: trial
2026-01-06 17:06:13,318 INFO: Dataset sizes -> train: 522, val: 93, test: 129
2026-01-06 17:06:13,318 INFO: Target neurons: [31] (indices: [30])
2026-01-06 17:06:13,323 INFO: Model architecture:
RNNModel(
  (initial_state_projection): Linear(in_features=110, out_features=32, bias=True)
  (rnn): GRU(10, 32, batch_first=True)
  (dense): Sequential(
    (0): Linear(in_features=32, out_features=1, bias=True)
  )
)
2026-01-06 17:06:13,323 INFO: Train input size: 10
2026-01-06 17:06:13,323 INFO: Initial condition size: 110 (FILTER_NEURONS)
2026-01-06 17:06:13,324 INFO: Train output size: 1 (TARGET_NEURONS)
2026-01-06 17:06:13,324 INFO: Hidden state size: 32
2026-01-06 17:06:13,325 INFO: Number of GRU layers: 1
2026-01-06 17:06:13,325 INFO: Learning rate 0.001
2026-01-06 17:06:13,326 INFO: Optimizer: Adam (
Parameter Group 0
    amsgrad: False
    betas: (0.9, 0.999)
    capturable: False
    decoupled_weight_decay: False
    differentiable: False
    eps: 1e-08
    foreach: None
    fused: None
    lr: 0.001
    maximize: False
    weight_decay: 0
)
2026-01-06 17:06:13,326 INFO: Loss type: mse
2026-01-06 17:06:13,327 INFO: Regularization coefficient: 0
2026-01-06 17:06:41,357 INFO: Epoch 1 Train loss: 0.018964323627323598
2026-01-06 17:06:41,621 INFO: Epoch 1 Validation loss: 0.020863355267592656
2026-01-06 17:06:41,628 INFO:   Saved best model with val loss 0.020863 to rnn_training/20260106_170551/best_model.pth
2026-01-06 17:06:46,431 INFO: Epoch 2 Train loss: 0.01871263878455678
2026-01-06 17:06:46,701 INFO: Epoch 2 Validation loss: 0.021720426387443977
2026-01-06 17:06:51,447 INFO: Epoch 3 Train loss: 0.01855673268794214
2026-01-06 17:06:51,649 INFO: Epoch 3 Validation loss: 0.02007377898741153
2026-01-06 17:06:51,653 INFO:   Saved best model with val loss 0.020074 to rnn_training/20260106_170551/best_model.pth
2026-01-06 17:06:56,334 INFO: Epoch 4 Train loss: 0.018337927004001265
2026-01-06 17:06:56,574 INFO: Epoch 4 Validation loss: 0.019605169493344524
2026-01-06 17:06:56,578 INFO:   Saved best model with val loss 0.019605 to rnn_training/20260106_170551/best_model.pth
2026-01-06 17:07:01,760 INFO: Epoch 5 Train loss: 0.017497610625493345
2026-01-06 17:07:01,972 INFO: Epoch 5 Validation loss: 0.021740698566039402
2026-01-06 17:07:06,696 INFO: Epoch 6 Train loss: 0.016694687513841525
2026-01-06 17:07:06,900 INFO: Epoch 6 Validation loss: 0.015190845085007528
2026-01-06 17:07:06,905 INFO:   Saved best model with val loss 0.015191 to rnn_training/20260106_170551/best_model.pth
2026-01-06 17:07:11,749 INFO: Epoch 7 Train loss: 0.011818858859097135
2026-01-06 17:07:12,061 INFO: Epoch 7 Validation loss: 0.011262271588327743
2026-01-06 17:07:12,065 INFO:   Saved best model with val loss 0.011262 to rnn_training/20260106_170551/best_model.pth
2026-01-06 17:07:16,857 INFO: Epoch 8 Train loss: 0.010607079263790814
2026-01-06 17:07:17,061 INFO: Epoch 8 Validation loss: 0.01265098842521829
2026-01-06 17:07:21,787 INFO: Epoch 9 Train loss: 0.008776559046615928
2026-01-06 17:07:21,986 INFO: Epoch 9 Validation loss: 0.008671305017165279
2026-01-06 17:07:21,990 INFO:   Saved best model with val loss 0.008671 to rnn_training/20260106_170551/best_model.pth
2026-01-06 17:07:26,749 INFO: Epoch 10 Train loss: 0.00789343892557411
2026-01-06 17:07:27,063 INFO: Epoch 10 Validation loss: 0.008299882969348341
2026-01-06 17:07:27,068 INFO:   Saved best model with val loss 0.008300 to rnn_training/20260106_170551/best_model.pth
2026-01-06 17:07:31,718 INFO: Epoch 11 Train loss: 0.007281367067547365
2026-01-06 17:07:31,919 INFO: Epoch 11 Validation loss: 0.008355194822915139
2026-01-06 17:07:36,654 INFO: Epoch 12 Train loss: 0.007071323586642114
2026-01-06 17:07:36,855 INFO: Epoch 12 Validation loss: 0.007701002882533176
2026-01-06 17:07:36,860 INFO:   Saved best model with val loss 0.007701 to rnn_training/20260106_170551/best_model.pth
2026-01-06 17:07:41,711 INFO: Epoch 13 Train loss: 0.006733252502749478
2026-01-06 17:07:42,032 INFO: Epoch 13 Validation loss: 0.007825809841354689
2026-01-06 17:07:47,204 INFO: Epoch 14 Train loss: 0.0065471247405927075
2026-01-06 17:07:47,460 INFO: Epoch 14 Validation loss: 0.007993479397007695
2026-01-06 17:07:52,189 INFO: Epoch 15 Train loss: 0.006458780150218257
2026-01-06 17:07:52,469 INFO: Epoch 15 Validation loss: 0.007543272744383543
2026-01-06 17:07:52,473 INFO:   Saved best model with val loss 0.007543 to rnn_training/20260106_170551/best_model.pth
2026-01-06 17:07:57,174 INFO: Epoch 16 Train loss: 0.005955876707602507
2026-01-06 17:07:57,389 INFO: Epoch 16 Validation loss: 0.00738934280290719
2026-01-06 17:07:57,392 INFO:   Saved best model with val loss 0.007389 to rnn_training/20260106_170551/best_model.pth
2026-01-06 17:08:03,105 INFO: Epoch 17 Train loss: 0.005717577840918782
2026-01-06 17:08:03,375 INFO: Epoch 17 Validation loss: 0.007444756666338572
2026-01-06 17:08:08,794 INFO: Epoch 18 Train loss: 0.0056737999635181205
2026-01-06 17:08:09,043 INFO: Epoch 18 Validation loss: 0.007306404707212282
2026-01-06 17:08:09,048 INFO:   Saved best model with val loss 0.007306 to rnn_training/20260106_170551/best_model.pth
2026-01-06 17:08:14,424 INFO: Epoch 19 Train loss: 0.0055964165331503215
2026-01-06 17:08:14,675 INFO: Epoch 19 Validation loss: 0.007384756259540076
2026-01-06 17:08:19,622 INFO: Epoch 20 Train loss: 0.005623242203181902
2026-01-06 17:08:19,917 INFO: Epoch 20 Validation loss: 0.0074396049203251
2026-01-06 17:08:24,673 INFO: Epoch 21 Train loss: 0.005432259716036447
2026-01-06 17:08:24,894 INFO: Epoch 21 Validation loss: 0.007328965711177036
2026-01-06 17:08:29,622 INFO: Epoch 22 Train loss: 0.0054851152347151
2026-01-06 17:08:29,928 INFO: Epoch 22 Validation loss: 0.00708533320776237
2026-01-06 17:08:29,932 INFO:   Saved best model with val loss 0.007085 to rnn_training/20260106_170551/best_model.pth
2026-01-06 17:08:34,991 INFO: Epoch 23 Train loss: 0.00566955783468639
2026-01-06 17:08:35,216 INFO: Epoch 23 Validation loss: 0.007497981981804935
2026-01-06 17:08:39,933 INFO: Epoch 24 Train loss: 0.005405546840408753
2026-01-06 17:08:40,227 INFO: Epoch 24 Validation loss: 0.0073004910441976725
2026-01-06 17:08:44,912 INFO: Epoch 25 Train loss: 0.0053551126043115994
2026-01-06 17:08:45,129 INFO: Epoch 25 Validation loss: 0.007215429808423724
2026-01-06 17:08:50,180 INFO: Epoch 26 Train loss: 0.005199282552326148
2026-01-06 17:08:50,485 INFO: Epoch 26 Validation loss: 0.007390037946332927
2026-01-06 17:08:55,352 INFO: Epoch 27 Train loss: 0.005339126653926468
2026-01-06 17:08:55,568 INFO: Epoch 27 Validation loss: 0.0073490314516088655
2026-01-06 17:09:00,448 INFO: Epoch 28 Train loss: 0.005426309185666371
2026-01-06 17:09:00,764 INFO: Epoch 28 Validation loss: 0.008244030665786516
2026-01-06 17:09:05,847 INFO: Epoch 29 Train loss: 0.005173098675949478
2026-01-06 17:09:06,162 INFO: Epoch 29 Validation loss: 0.007050251117556966
2026-01-06 17:09:06,167 INFO:   Saved best model with val loss 0.007050 to rnn_training/20260106_170551/best_model.pth
2026-01-06 17:09:11,089 INFO: Epoch 30 Train loss: 0.005132661141291032
2026-01-06 17:09:11,310 INFO: Epoch 30 Validation loss: 0.007207471111248578
2026-01-06 17:12:14,587 INFO: Test Loss: 0.007177
2026-01-06 17:12:28,002 INFO: Config 1 has 24 matching snippets (stim at t=0), neurons: [31]
2026-01-06 17:12:28,302 INFO: Config 2 has 24 matching snippets (stim at t=0), neurons: [31]
2026-01-06 17:12:28,593 INFO: Config 3 has 24 matching snippets (stim at t=0), neurons: [31]
2026-01-06 17:12:28,919 INFO: Config 4 has 24 matching snippets (stim at t=0), neurons: [31]
2026-01-06 17:12:29,198 INFO: Config 5 has 24 matching snippets (stim at t=0), neurons: [31]
2026-01-06 17:12:29,479 INFO: Config 6 has 24 matching snippets (stim at t=0), neurons: [31]
2026-01-06 17:12:29,759 INFO: Config 7 has 24 matching snippets (stim at t=0), neurons: [31]
2026-01-06 17:12:30,049 INFO: Config 8 has 24 matching snippets (stim at t=0), neurons: [31]
2026-01-06 17:12:30,332 INFO: Config 9 has 24 matching snippets (stim at t=0), neurons: [31]
2026-01-06 17:12:30,613 INFO: Config 10 has 24 matching snippets (stim at t=0), neurons: [31]
2026-01-06 17:12:31,069 INFO: Config 11 has 24 matching snippets (stim at t=0), neurons: [31]
2026-01-06 17:12:31,353 INFO: Config 12 has 24 matching snippets (stim at t=0), neurons: [31]
2026-01-06 17:12:31,636 INFO: Config 13 has 24 matching snippets (stim at t=0), neurons: [31]
2026-01-06 17:12:31,919 INFO: Config 14 has 24 matching snippets (stim at t=0), neurons: [31]
2026-01-06 17:12:32,210 INFO: Config 15 has 24 matching snippets (stim at t=0), neurons: [31]
2026-01-06 17:12:32,500 INFO: Config 16 has 24 matching snippets (stim at t=0), neurons: [31]
2026-01-06 17:12:32,785 INFO: Config 17 has 24 matching snippets (stim at t=0), neurons: [31]
2026-01-06 17:12:33,222 INFO: Config 18 has 24 matching snippets (stim at t=0), neurons: [31]
2026-01-06 17:12:33,620 INFO: Config 19 has 24 matching snippets (stim at t=0), neurons: [31]
2026-01-06 17:12:33,898 INFO: Config 20 has 24 matching snippets (stim at t=0), neurons: [31]
2026-01-06 17:12:34,177 INFO: Config 21 has 24 matching snippets (stim at t=0), neurons: [31]
2026-01-06 17:12:34,455 INFO: Config 22 has 24 matching snippets (stim at t=0), neurons: [31]
2026-01-06 17:12:34,845 INFO: Config 23 has 24 matching snippets (stim at t=0), neurons: [31]
2026-01-06 17:12:35,127 INFO: Config 24 has 24 matching snippets (stim at t=0), neurons: [31]
2026-01-06 17:12:35,406 INFO: Config 25 has 24 matching snippets (stim at t=0), neurons: [31]
2026-01-06 17:12:35,687 INFO: Config 26 has 24 matching snippets (stim at t=0), neurons: [31]
2026-01-06 17:12:35,966 INFO: Config 27 has 24 matching snippets (stim at t=0), neurons: [31]
2026-01-06 17:12:36,246 INFO: Config 28 has 24 matching snippets (stim at t=0), neurons: [31]
2026-01-06 17:12:36,522 INFO: Config 29 has 24 matching snippets (stim at t=0), neurons: [31]
2026-01-06 17:12:36,801 INFO: Config 30 has 24 matching snippets (stim at t=0), neurons: [31]
2026-01-06 17:12:37,077 INFO: Config 31 has 0 matching snippets (stim at t=0), neurons: [31]
2026-01-06 17:12:37,077 INFO: No matching snippets for config 31 with stim at offset 0, skipping.
